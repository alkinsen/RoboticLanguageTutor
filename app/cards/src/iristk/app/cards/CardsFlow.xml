<?xml version="1.0" encoding="utf-8"?>
<flow name="CardsFlow" package="iristk.app.cards" 
	initial="Start" xmlns:this="iristk.app.cards.CardsFlow" xmlns="iristk.flow" 
	xmlns:p="iristk.flow.param" xmlns:agent="iristk.situated.SystemAgentFlow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="iristk.flow flow.xsd iristk.situated.SystemAgentFlow SystemAgentFlow.xsd">
	
	<import class="iristk.situated.Location"/>
	<import class="application.TextToSpeech"/>
	
	
	<param name="agent" type="iristk.situated.SystemAgentFlow"/>
	
	<var name="system" type="iristk.situated.SystemAgent" value="agent.getSystemAgent()"/> 
	<var name="tts" type="application.TextToSpeech" value="new TextToSpeech()"/>

	<state id="Start" extends="Dialog">
		<onentry>
			<exec>tts.setVoice("dfki-ot-hsmm");</exec>
			<call state="lookCaretaker"/>
			<agent:say>Hello there, do you want to learn or play a game?</agent:say>
			<call state="lookChild"/>
			<!-- (System.out.println\()(.*)(\)) -->
			<exec>tts.speak("Oyun oynamak ister misiniz?", 1.0f, false, false);</exec>
			<agent:listen/>
		</onentry>
		<onevent name="sense.user.speak" cond="event?:sem:learn">
			<goto state="Learn"/>
		</onevent>
		<onevent name="sense.user.speak" cond="event?:sem:play">
			<goto state="Play"/>
		</onevent>
	</state>
	
	
	
	<state id="Play" extends="Dialog">
		<onentry>
			<call state="lookChild"/>
			<agent:say>Let's have some fun. Which subject would you like to play with?</agent:say>
			<agent:listen/>
		</onentry>
		
		<onevent name="sense.user.speak" cond="event?:sem:animal">
			<goto state="PlayAnimals"/>
		</onevent>
		<onevent name="sense.user.speak" cond="event?:sem:color">
			<goto state="PlayColors"/>
		</onevent>
		<onevent name="sense.user.speak" cond="event?:sem:body">
			<goto state="PlayBody"/>
		</onevent>
		
	</state>
	
	<state id="PlayBody">
		<onentry>
			<agent:say>Alright. Let's see if you have learned your body.</agent:say>
		</onentry>
	</state>
	
	<state id="PlayColors">
		<onentry>
			<agent:say>Let's see if you have learned your colors.</agent:say>
			<wait msec="3000"/>
			<call state="lookCaretaker"/>
			<call state="PlayPrepare"/>
			
			<agent:say>Let's start the game.</agent:say>
			<exec>tts.speak("Oyuna basliyoruz.", 1.0f, false, false);</exec>
			
			<call state="lookChild"/>
			<agent:say>Can you show me the color red?</agent:say>
			<exec>tts.speak("Cocuga kirmizi rengini gostermesini istedim.", 1.0f, false, false);</exec>
			<call state="lookBoard"/>
			<wait msec="4000"/>
			<call state="Showing"/>
		
			<call state="lookChild"/>
			<agent:say>Can you show me the color purple?</agent:say>
			<exec>tts.speak("Cocuga mor rengini gostermesini istedim.", 1.0f, false, false);</exec>
			<call state="lookBoard"/>
			<wait msec="4000"/>
			<call state="Showing"/>
			
			<call state="lookChild"/>
			<agent:say>Can you first show me the color orange then yellow?</agent:say>
			<exec>tts.speak("Cocuga once turuncu sonra sari rengini.", 1.0f, false, false);</exec>
			<call state="lookBoard"/>
			<wait msec="4000"/>
			<call state="Showing"/>
			
			<call state="lookChild"/>
			<agent:say>Can you show me the color of grass?</agent:say>
			<exec>tts.speak("Cocuga yesil rengini gostermesini istedim.", 1.0f, false, false);</exec>
			<call state="lookBoard"/>
			<wait msec="4000"/>
			<call state="Showing"/>
			
			<call state="lookChild"/>
			<agent:say>Can you show me the color of firetruck?</agent:say>
			<exec>tts.speak("Cocuga kirmizi rengini gostermesini istedim.", 1.0f, false, false);</exec>
			<call state="lookBoard"/>
			<wait msec="4000"/>
			<call state="Showing"/>
			
			<goto state="CheckAgain"/>		
		</onentry>
	</state>
	
	
	<state id="PlayAnimals">
		<onentry>
			<agent:say>Great choice. I love animals. </agent:say>
			<wait msec="3000"/>
			<call state="lookCaretaker"/>
			<call state="PlayPrepare"/>
			
			<agent:say>Let's start the game.</agent:say>
			<exec>tts.speak("Oyuna basliyoruz.", 1.0f, false, false);</exec>
			
			<call state="lookChild"/>
			<agent:say>Can you show me the dog on the board?</agent:say>
			<exec>tts.speak("Cocuga kopek fotografini gostermesini istedim.", 1.0f, false, false);</exec>
			<call state="lookBoard"/>
			<wait msec="4000"/>
			<call state="Showing"/>
		
			<call state="lookChild"/>
			<agent:say>Can you show me the fish on the board?</agent:say>
			<exec>tts.speak("Cocuktan balik fotografini gostermesini istedim.", 1.0f, false, false);</exec>
			<call state="lookBoard"/>
			<wait msec="4000"/>
			<call state="Showing"/>
			
			<call state="lookChild"/>
			<agent:say>Can you show me the animal that flies on the board?</agent:say>
			<exec>tts.speak("Cocuga kus fotografini gostermesini istedim.", 1.0f, false, false);</exec>
			<call state="lookBoard"/>
			<wait msec="4000"/>
			<call state="Showing"/>
			
			<call state="lookChild"/>
			<agent:say>Can you show me the animals that have four legs?</agent:say>
			<exec>tts.speak("Cocuga hem kedi hem de kopek fotografini gostermesini istedim.", 1.0f, false, false);</exec>
			<call state="lookBoard"/>
			<wait msec="4000"/>
			<call state="Showing"/>
			
			<call state="lookChild"/>
			<agent:say>Can you show me the animal that says meow?</agent:say>
			<exec>tts.speak("Cocuga kedi fotografini gostermesini istedim.", 1.0f, false, false);</exec>
			<call state="lookBoard"/>
			<wait msec="4000"/>
			<call state="Showing"/>
			
			<goto state="CheckAgain"/>			
			
		</onentry>
	
		
		
	</state>
	
	<state id="PlayPrepare" extends="Dialog">
		<onentry>
			<exec>tts.speak("Ilgili desteyi aliniz ve rastgele diziniz. Dizme bitince OKEY diyin.", 1.0f, false, false);</exec>
			<agent:say>Would you please distribute the cards to the board?</agent:say>
			<agent:listen/>
		</onentry>
		<onevent name="sense.user.speak" cond="event?:sem:okay">
			<return/>
		</onevent>
	</state>
	
	<state id="Showing">
		<onentry>
			<call state="lookCaretaker"/>
			<agent:say>Is that correct?</agent:say>
			<exec>tts.speak("Eger dogru karti gosterdiyse yes sesi cikarin, yoksa no sesi cikarin", 1.0f, false, false);</exec>
			<wait msec="4000"/>
			<agent:listen/>
		</onentry>
		<onevent name="sense.user.speak" cond="event?:sem:yes">
			<call state="lookChild"/>
			<agent:say>Good Job. You are doing great.</agent:say>
			<wait msec="3000"/>
			<return/>
		</onevent>
		
		<onevent name="sense.user.speak" cond="event?:sem:no">
			<call state="lookChild"/>
			<agent:say>It's alright. Let's see which one is the correct answer.</agent:say>
			<call state="lookCaretaker"/>
			<agent:say>Can you show me the correct answer please?</agent:say>
			<exec>tts.speak("Dogru cevabi cocuga gosteriniz.", 1.0f, false, false);</exec>
			<wait msec="4000"/>
			<agent:say>Let's continue.</agent:say>
			<return/>
		</onevent>
		
		<onevent name="sense.user.speak">
			<agent:say>I did not get that.</agent:say>
			<goto state="Showing"/>
		</onevent>
	</state>
	
	
	<state id="Learn" extends="Dialog">
		<onentry>
			<agent:say>Let's start learning. What do you want to learn about?</agent:say>
			<agent:listen/>
		</onentry>
		<onevent name="sense.user.speak" cond="event?:sem:color">
			<exec>tts.speak("Renk kartlarinin oldugu desteyi aliniz.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>Okay, let's learn about colors.</agent:say>
			<goto state="TeachColors"/>
		</onevent>
		<onevent name="sense.user.speak" cond="event?:sem:animal">
			<exec>tts.speak("Hayvan kartlarinin oldugu desteyi aliniz.", 1.0f, false, false);</exec>
			<agent:say>Okay, let's learn about animals.</agent:say>
			<goto state="TeachAnimals"/>
		</onevent>
		<onevent name="sense.user.speak" cond="event?:sem:body">
			<agent:say>Okay, let's learn about body parts.</agent:say>
			<goto state="TeachBody"/>
		</onevent>
	</state>
	
	<!-- STATES ABOUT TEACHING BODY PARTS -->
	<state id="TeachBody">
		<onentry>
			<agent:say>Let's learn about our heads, shoulders, knees and toes.</agent:say>
			
			<call state="lookCaretaker"/>
			<call state="lookChild"/>
			<exec>tts.speak("Kafanizi, sonra bebegin kafasini isaret edin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>This is your head.</agent:say>
			
			<exec>tts.speak("Omuzlariniza, sonra bebegin omuzlarina dokunun.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>These are your shoulders.</agent:say>

			<exec>tts.speak("Dizlerinize, daha sonra bebegin dizlerine dokunun.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>These are your knees.</agent:say>

			<exec>tts.speak("Ayaklariniza, daha sonra bebegin ayaklarina dokunun.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>These are your toes.</agent:say>

			<exec>tts.speak("Gozlerinizi, daha sonra bebegin gozlerini isaret edin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>These are your eyes.</agent:say>
			<exec>tts.speak("Iki parmaginizi gosterin.", 1.0f, false, false);</exec>
			<wait msec="2000"/>
			<agent:say>We have two eyes. Two eyes.</agent:say>

			<exec>tts.speak("Kulaklariniza, daha sonra bebegin kulaklarina dokunun.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>These are your ears.</agent:say>
			<exec>tts.speak("Iki parmaginizi gosterin.", 1.0f, false, false);</exec>
			<wait msec="2000"/>
			<agent:say>We have two ears. Two ears.</agent:say>

			<exec>tts.speak("Bebege opucuk atin ve agizinizi gosterin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>This is your mouth.</agent:say>
			<exec>tts.speak("Bir parmaginizi kaldirin.", 1.0f, false, false);</exec>
			<wait msec="2000"/>
			<agent:say>We have one mouth. One mouth.</agent:say>

			<exec>tts.speak("Burnunuza, sonra bebegin burnuna dokunun.", 1.0f, false, false);</exec>
			<wait msec="4000"/>
			<agent:say>This is your nose.</agent:say>
			<exec>tts.speak("Bir parmaginizi kaldirin.", 1.0f, false, false);</exec>
			<wait msec="2000"/>
			<agent:say>We have one nose. One nose.</agent:say>

			<exec>tts.speak("Iki elinizi bebege dogru sallayin.", 1.0f, false, false);</exec>
			<wait msec="4000"/>
			<agent:say>These are our hands.</agent:say>
			<exec>tts.speak("Iki elinizi gosterin.", 1.0f, false, false);</exec>
			<wait msec="2000"/>
			<agent:say>We have two hands. Two hands.</agent:say>

			<exec>tts.speak("Parmaklarinizi bebegin onunde hareket ettirin.", 1.0f, false, false);</exec>
			<wait msec="4000"/>
			<agent:say>These are our fingers.</agent:say>
			<exec>tts.speak("On parmaginizi gosterin.", 1.0f, false, false);</exec>
			<wait msec="2000"/>
			<agent:say>We have ten fingers. Ten fingers.</agent:say>

			<agent:say>That was fun. Now, let's listen to the song again.</agent:say>
			 
		</onentry>
	</state>
	<!-- STATES ABOUT TEACHING BODY PARTS -->
	
	<!-- STATES ABOUT TEACHING ANIMALS -->
	<state id="TeachAnimals">
		<onentry>
			<call state="lookChild"/>
			<exec>tts.speak("Kopek kartini gosterin ve sallayin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>This is a dog. The dog says woof. </agent:say>
			<call state="lookCaretaker"/>
			<exec>tts.speak("WUF WUF diyin bir kac kez ve sonraki sesle birlikte 4 parmak gosterin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>The dog has 4 legs.</agent:say>
			
			<call state="lookChild"/>
			<exec>tts.speak("Kedi kartini gosterin ve sallayin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>This is a cat. The cat says meow. </agent:say>
			<call state="lookCaretaker"/>
			<exec>tts.speak("MIAV MIAV diyin bir kac kez ve sonra elinizle 4 parmak gosterin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>The cat also has 4 legs like dog.</agent:say>
			
			<call state="lookChild"/>
			<exec>tts.speak("Balik kartini gosterin ve sallayin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>This is a fish. The fish lives under the sea and swims. </agent:say>
			<call state="lookCaretaker"/>
			<exec>tts.speak("Ellerinizi birlestirip balik gibi saga sola sallayin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>The fish have fins and a tail.</agent:say>
			
			<call state="lookChild"/>
			<exec>tts.speak("Kus kartini gosterin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>This is a bird. The bird flies in the sky.</agent:say>
			<call state="lookCaretaker"/>
			<exec>tts.speak("Ucan kus gibi kollarinizi cirpin ve FILAY diyin bir kac kez.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>The bird lays eggs in its nest.</agent:say>
			
			<call state="lookChild"/>
			<exec>tts.speak("Ordek kartini gosterin ve sallayin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>This is a duck. The duck says quack.</agent:say>
			<call state="lookCaretaker"/>
			<exec>tts.speak("VAK VAK diyin bir kac", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>The duck can swim.</agent:say>
			
			<call state="lookChild"/>	
			<exec>tts.speak("Kurbaga kartini gosterin ve sallayin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>This is a frog. The frog has a very long tongue.</agent:say>
			<call state="lookCaretaker"/>
			<exec>tts.speak("Dilinizi cikartin kisa bir sure.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>The frog lives in both water and land.</agent:say>

			<call state="lookChild"/>	
			<exec>tts.speak("At kartini gosterin ve sallayin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>This is a horse. The horse can run very fast.</agent:say>

			<exec>tts.speak("Ayi kartini gosterin ve sallayin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>This is a bear. The bear is very big.</agent:say>
			<call state="lookCaretaker"/>
			<exec>tts.speak("Ellerinizi pence yapip, havaya kaldirin ve BIG BEIR diyin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			
			<call state="lookChild"/>
			<agent:say>Now you know your animals.</agent:say>
			<goto state="CheckAgain"/>
		</onentry>
	</state>
	<!-- STATES ABOUT TEACHING ANIMALS -->
	
	<!-- STATES ABOUT TEACHING COLORS -->
	<state id="TeachColors">
		<onentry>
			<call state="TeachRed"/>
			<call state="TeachBlue"/>
			<call state="TeachGreen"/>
			<call state="TeachYellow"/>
			<call state="TeachOrange"/>
			<call state="TeachPurple"/>
			
			<wait msec="2000"/>
			<agent:say>Now you know your colors.</agent:say>
			<goto state="CheckAgain"/>
		</onentry>
	</state>
	
	
	<state id="TeachRed">
		<onentry>
			<call state="lookChild"/>
			<exec>tts.speak("Kirmizi renkli karti gosterin ve sallayin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>This is red.</agent:say>
			
			<call state="lookCaretaker"/>
			<exec>tts.speak("Kirmizi karti cevirip sirayla itfaiye araci, trafik levhasi ve elma resimlerine isaret edin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>The firetruck, the stop sign and the apple are all red. Red</agent:say>
			<return/>
		</onentry>
	</state>
	
	<state id="TeachBlue">
		<onentry>
			<call state="lookChild"/>
			<exec>tts.speak("Mavi renkli karti gosterin ve sallayin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>This is blue. </agent:say>
			
			<call state="lookCaretaker"/>
			<exec>tts.speak("Mavi karti cevirip sirayla deniz, gokyuzu ve kelebek resimlerine isaret edin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>The sea, the sky and the butterfly are all blue. Blue</agent:say>
			<return/>
		</onentry>
	</state>
	
	<state id="TeachGreen">
		<onentry>
			<call state="lookChild"/>
			<exec>tts.speak("Yesil renkli karti gosterin ve sallayin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>This is green.</agent:say>
			
			<call state="lookCaretaker"/>
			<exec>tts.speak("Yesil karti cevirip sirayla cimen, agac ve armut resimlerine isaret edin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>The grass, the tree and the pear are all green. Green</agent:say>
			<return/>
		</onentry>
	</state>

	<state id="TeachYellow">
		<onentry>
			<call state="lookChild"/>
			<exec>tts.speak("Sari renkli karti gosterin ve sallayin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>This is yellow.</agent:say>
			
			<call state="lookCaretaker"/>
			<exec>tts.speak("Sari karti cevirip sirayla limon, ordek ve muz resimlerine isaret edin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>The lemon, the duck and the banana are all yellow. Yellow</agent:say>
			<return/>
		</onentry>
	</state>
	
	<state id="TeachOrange">
		<onentry>
			<call state="lookChild"/>
			<exec>tts.speak("Turuncu renkli karti gosterin ve sallayin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>This is orange.</agent:say>
			
			<call state="lookCaretaker"/>
			<exec>tts.speak("Turunucu karti cevirip sirayla portakal, havuc ve top resimlerine isaret edin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>The orange, the carrot and the basketball are all orange. Orange</agent:say>
			<return/>
		</onentry>
	</state>

	<state id="TeachPurple">
		<onentry>
			<call state="lookChild"/>
			<exec>tts.speak("Mor renkli karti gosterin ve sallayin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>This is purple.</agent:say>
			
			<call state="lookCaretaker"/>
			<exec>tts.speak("Mor karti cevirip sirayla uzum, patlican ve bot resimlerine isaret edin.", 1.0f, false, false);</exec>
			<wait msec="3000"/>
			<agent:say>The grapes, the eggplant and the boots are all purple. Purple</agent:say>
			<return/>
		</onentry>
	</state>
	<!-- STATES ABOUT TEACHING COLORS -->
	
	
	<!-- CHECK TO CONTINUE OR EXIT -->
	<state id="CheckAgain" extends="Dialog">
		<onentry>
			<agent:say>Do you want to continue?</agent:say>
			<agent:listen/>
		</onentry>
		<onevent name="sense.user.speak" cond="event?:sem:yes">
			<agent:say>Okay, let's play again.</agent:say>
			<goto state="Start"/>
		</onevent>
		<onevent name="sense.user.speak" cond="event?:sem:no">
			<agent:say>Okay, goodbye</agent:say>
			<exec>System.exit(0)</exec>
		</onevent>		
	</state>
	
	<state id="Dialog">
		<onevent name="sense.user.silence">
			<agent:say>I am sorry, I didn't hear anything.</agent:say>
			<reentry/>
		</onevent>
		<onevent name="sense.user.speak">
			<agent:say>I am sorry, I didn't get that.</agent:say>
			<reentry/>
		</onevent>
	</state>
	
	<!-- CONTROLLING FURHAT GAZE -->
	<state id="lookAround">
		<param name="degx" type="float" default="0.0" />
		<param name="degy" type="float" default="0.0" />
		<param name="degz" type="float" default="0.0" />
		<onentry>
			<send event="action.gaze" p:location="new Location(degx, degy, degz)" />
			<return />
		</onentry>
	</state>

	<state id="lookCaretaker">
		<onentry>
			<send event="action.gaze" p:location="new Location(-1, 0, 1)" />
			<return />
		</onentry>
	</state>
	
	<state id="lookChild">
		<onentry>
			<send event="action.gaze" p:location="new Location(1, 0, 1)" />
			<return />
		</onentry>
	</state>
	
	<state id="lookBoard">
		<onentry>
			<send event="action.gaze" p:location="new Location(0, -1, 1)" />
			<return />
		</onentry>
	</state>
	<!-- CONTROLLING FURHAT GAZE -->	
	
</flow>